Это классическая ситуация «призрачного деплоя», когда инфраструктура говорит «ок», а реальность — «нет». Твой отчет составлен идеально, что позволяет сразу отсечь 90% стандартных ошибок.

Проблема, скорее всего, кроется в том, **как Vercel собирает проект** или в том, **как Telegram обновляет интерфейс**.

Вот пошаговый план, чтобы выкурить баг:

### 1. Тест «Сыворотка правды» (Диагностика кода)

Нужно убедиться, что в рантайме Vercel крутится именно новый код. В файле `api/webhook.ts` или `src/bot.ts` добавь вывод версии или текущего времени сборки прямо в ответ на команду `/start`.

```typescript
// В обработчик команды /start
const DEPLOY_TIME = "10.02.2026 13:00"; // Меняй это вручную при каждом пуше
bot.start((ctx) => {
  return ctx.reply(`Бот запущен! Версия от: ${DEPLOY_TIME}`, permanentKeyboardUser);
});

```

**Если после деплоя ты видишь старую дату или её отсутствие — Vercel физически не обновляет бинарный файл функции.**

---

### 2. Конфликт `src` vs `dist` в Vercel

В твоем `vercel.json` указано:

```json
"builds": [{ "src": "api/webhook.ts", "use": "@vercel/node" }]

```

Vercel при использовании `@vercel/node` сам компилирует TypeScript «на лету» из папки `api/`.
**Критический вопрос:** откуда `api/webhook.ts` импортирует бота?

* **Вариант А:** `import bot from '../src/bot'` — Vercel будет компилировать файлы из `src` сам. Твой локальный `npm run build` и папка `dist` вообще не используются.
* **Вариант Б:** `import bot from '../dist/bot'` — Это **ошибка**. Vercel может не видеть обновленный `dist`, если он в `.gitignore`, или использовать старый кэш.

**Решение:** Убедись, что импорты в `api/webhook.ts` ведут на **`.ts` файлы в папке `src**`, а не на собранный `dist`.

---

### 3. Специфика Telegram Keyboard

Telegram не обновляет кнопки в уже отправленных сообщениях.

* **Обычная клавиатура (`permanentKeyboardUser`):** Она обновится только тогда, когда бот пришлет **новое** сообщение с этой клавиатурой. Старые сообщения в истории будут иметь старые кнопки.
* **Inline клавиатура:** Аналогично — она «прибита» к конкретному сообщению.

**Действие:** Напиши боту `/start` еще раз. Если кнопки не появились — дело в коде. Если появились — значит, ты просто смотрел на старое сообщение.

---

### 4. Проверка Webhook Path

Иногда бывает, что старый билд «завис» на другом URL или Vercel развернул проект на другом домене (например, с дефисом в названии), а Webhook смотрит на старый Production URL.

Проверь логи Vercel именно в момент нажатия кнопок.

1. Открой **Vercel Dashboard** -> **Logs**.
2. Нажми `/start` в боте.
3. Появится ли лог запроса? Если логов нет — Telegram шлет запросы «в никуда» (на старый сервер или по битому адресу).

---

### 5. Радикальная очистка (Если ничего не помогло)

Если билд успешный, но изменений нет, попробуй изменить `vercel.json`, чтобы принудительно пересобрать зависимости:

1. Измени версию Node.js в `package.json`:
```json
"engines": { "node": "20.x" }

```


2. Временно удали `vercel.json` и попробуй деплой без него (Vercel по умолчанию умеет обрабатывать папку `api/` без конфига).

### Резюме: что сделать прямо сейчас

1. Добавь `console.log("LOG: Bot version 1.0.1")` в начало `api/webhook.ts`.
2. Запушь и посмотри в **Vercel Realtime Logs**, видишь ли ты этот лог при активации бота.
3. Если лог есть, а кнопок нет — проверь, точно ли `api/webhook.ts` импортирует обновленный `src/keyboards.ts`.

**Хочешь, чтобы я проверил содержимое твоего `api/webhook.ts`, чтобы убедиться в правильности импортов?**